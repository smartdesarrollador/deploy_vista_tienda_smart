import './polyfills.server.mjs';
import{a as l}from"./chunk-NIVLWR4S.mjs";import{Ib as n,Jb as m,d as o,g as p,h as u,k as r,s,v as c,z as d}from"./chunk-D7UFLJ5T.mjs";var C=class g{http=d(m);apiUrl=`${l.urlDominioApi}/api`;adminApiUrl=`${l.urlDominioApi}/api/admin`;categoriasSubject=new o([]);categoriaTreeSubject=new o([]);loadingSubject=new o(!1);totalCategoriasSubject=new o(0);categorias$=this.categoriasSubject.asObservable();categoriaTree$=this.categoriaTreeSubject.asObservable();loading$=this.loadingSubject.asObservable();totalCategorias$=this.totalCategoriasSubject.asObservable();getCategorias(e){this.loadingSubject.next(!0);let t=new n;return e&&Object.entries(e).forEach(([a,i])=>{i!=null&&i!==""&&(t=t.set(a,i.toString()))}),this.http.get(`${this.apiUrl}/categorias`,{params:t}).pipe(s(a=>{this.categoriasSubject.next(a.data),this.totalCategoriasSubject.next(a.meta.total),this.loadingSubject.next(!1)}),r(a=>(this.loadingSubject.next(!1),this.handleError(a))))}getCategoriaTree(){return this.http.get(`${this.apiUrl}/categorias/tree`).pipe(s(e=>{this.categoriaTreeSubject.next(e.data)}),r(this.handleError))}getCategoriasPrincipales(){return this.http.get(`${this.apiUrl}/categorias/principales`).pipe(r(this.handleError))}getCategoriaById(e){return this.http.get(`${this.apiUrl}/categorias/${e}`).pipe(r(this.handleError))}getCategoriaBySlug(e){return this.http.get(`${this.apiUrl}/categorias/slug/${e}`).pipe(r(this.handleError))}createCategoria(e){return this.loadingSubject.next(!0),this.http.post(`${this.adminApiUrl}/categorias`,e).pipe(s(()=>{this.loadingSubject.next(!1),this.refreshData()}),r(t=>(this.loadingSubject.next(!1),this.handleError(t))))}updateCategoria(e,t){return this.loadingSubject.next(!0),this.http.put(`${this.adminApiUrl}/categorias/${e}`,t).pipe(s(()=>{this.loadingSubject.next(!1),this.refreshData()}),r(a=>(this.loadingSubject.next(!1),this.handleError(a))))}deleteCategoria(e){return this.loadingSubject.next(!0),this.http.delete(`${this.adminApiUrl}/categorias/${e}`).pipe(s(()=>{this.loadingSubject.next(!1),this.refreshData()}),r(t=>(this.loadingSubject.next(!1),this.handleError(t))))}updateCategoriaOrder(e){return this.loadingSubject.next(!0),this.http.put(`${this.adminApiUrl}/categorias/order/update`,e).pipe(s(()=>{this.loadingSubject.next(!1),this.refreshData()}),r(t=>(this.loadingSubject.next(!1),this.handleError(t))))}getCategoriaStats(){return this.http.get(`${this.adminApiUrl}/categorias/stats`).pipe(r(this.handleError))}searchCategorias(e,t=10){let a=new n().set("search",e).set("per_page",t.toString());return this.http.get(`${this.apiUrl}/categorias`,{params:a}).pipe(u(i=>i.data),r(this.handleError))}checkCategoriaHasProducts(e){return this.http.get(`${this.adminApiUrl}/categorias/${e}/check-products`).pipe(r(this.handleError))}checkCategoriaHasSubcategorias(e){return this.http.get(`${this.adminApiUrl}/categorias/${e}/check-subcategorias`).pipe(r(this.handleError))}getCategoriasForSelect(){return this.http.get(`${this.apiUrl}/categorias/for-select`).pipe(r(this.handleError))}refreshData(){this.getCategorias().subscribe(),this.getCategoriaTree().subscribe()}clearCache(){this.categoriasSubject.next([]),this.categoriaTreeSubject.next([]),this.totalCategoriasSubject.next(0)}getCurrentCategorias(){return this.categoriasSubject.getValue()}getCurrentTree(){return this.categoriaTreeSubject.getValue()}validateNombreDisponible(e,t){let a=new n().set("nombre",e);return t&&(a=a.set("exclude_id",t.toString())),this.http.get(`${this.adminApiUrl}/categorias/validate-nombre`,{params:a}).pipe(r(this.handleError))}getBreadcrumb(e){return this.http.get(`${this.apiUrl}/categorias/${e}/breadcrumb`).pipe(r(this.handleError))}getFullPath(e){let t=this.getCurrentTree();return this.findCategoryPath(t,e,[])}findCategoryPath(e,t,a){for(let i of e){let h=[...a,i.nombre];if(i.id===t)return h.join(" > ");if(i.subcategorias&&i.subcategorias.length>0){let b=this.findCategoryPath(i.subcategorias,t,h);if(b)return b}}return""}handleError=e=>{console.error("CategoriasService Error:",e);let t="Ha ocurrido un error inesperado";return e.error?.message?t=e.error.message:e.message&&(t=e.message),p(()=>new Error(t))};static \u0275fac=function(t){return new(t||g)};static \u0275prov=c({token:g,factory:g.\u0275fac,providedIn:"root"})};export{C as a};
