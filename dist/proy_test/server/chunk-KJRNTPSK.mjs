import './polyfills.server.mjs';
import{e as f}from"./chunk-5XUXGTUW.mjs";var c=f(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.default=void 0;var v=function(i,t,n){var a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:150,r=function o(){i[t]?n():setTimeout(o,a)};setTimeout(r,0)};u.default=v});var y=f(l=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0});l.default=void 0;var h=p(c());function p(e){return e&&e.__esModule?e:{default:e}}function w(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function m(e,i){for(var t=0;t<i.length;t++){var n=i[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function b(e,i,t){return i&&m(e.prototype,i),t&&m(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}var _=function(){function e(){return w(this,e),e.instance?e.instance:(e.instance=this,this._name="Krypton Glue",this.configuration={},this.domain=null,this.formToken=null,this.publicKey=null,this.loaded=!1,this.loading=!1,this)}return b(e,[{key:"loadLibrary",value:function(t,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=/^\d{2,8}:(|test)publickey_.+$/g;if(this.loaded)return this.getKrypton(n);if(!t)return Promise.reject("Domain not defined");if(!n)return Promise.reject("Public key not defined");try{var o=new URL(t);if(!["http:","https:"].includes(o.protocol))throw new Error("Invalid protocol");if(o.port)throw new Error("No port allowed");if(o.search!=="")throw new Error("No query params allowed");if(o.pathname!=="/")throw new Error("Invalid path")}catch{return console.error("Domain format should be https://domain.name"),Promise.reject("[".concat(t,"] is not a valid endpoint domain"))}return r.test(n)?(this.domain=t,this.publicKey=n,this.formToken=a,this.domain&&this.publicKey?this.loadKryptonClient():Promise.reject("The library cannot be loaded")):(console.error("Public key format should be shopId:[test]publickey_*"),Promise.reject("[".concat(n,"] is not a valid public key")))}},{key:"loadKryptonClient",value:function(){var t=this;if(!this.loading){var n=this.publicKey,a=this.domain;this.loading=!0;var r=document.createElement("script");r.type="text/javascript",/^.+\/$/.test(a)||(a+="/"),r.src="".concat(a,"static/js/krypton-client/V4.0/stable/kr-payment-form.min.js"),r.setAttribute("kr-public-key",n),r.setAttribute("kr-spa-mode","true"),this.formToken&&r.setAttribute("kr-form-token",this.formToken);var o=document.querySelector('script[src="'.concat(r.src,'"]'));!o&&document.body?document.body.appendChild(r):document.body||console.warn("document.body is undefined")}return new Promise(function(d){(0,h.default)(window,"KR",function(){(0,h.default)(window.KR,"ready",function(){t.loaded=!0,t.loading=!1,d({KR:window.KR})})})})}},{key:"getKrypton",value:function(t){var n=this;return new Promise(function(a,r){t&&t!==n.publicKey?window.KR.setFormConfig({publicKey:t}).then(a).catch(r):a({KR:window.KR})})}}]),e}(),k=new _;l.default=k});var R=f(s=>{Object.defineProperty(s,"__esModule",{value:!0});s.default=void 0;var g=K(y());function K(e){return e&&e.__esModule?e:{default:e}}var P=g.default;s.default=P});export default R();
