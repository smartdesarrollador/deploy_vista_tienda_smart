import './polyfills.server.mjs';
import{a as pt}from"./chunk-RYZWVBKO.mjs";import{a as U}from"./chunk-NIVLWR4S.mjs";import{Aa as s,Ab as ct,B as K,Ba as n,Ca as w,Cb as X,Da as A,Ea as k,Fa as l,I as M,Ib as V,J as D,Ja as u,Jb as lt,K as S,Ka as C,La as f,R as I,S as $,Sa as ot,Va as it,X as tt,Xa as rt,ac as dt,ca as L,d as Y,ec as ut,g as Z,ga as a,k as v,la as y,na as p,nb as _,o as g,oa as et,ob as at,pa as P,pb as nt,ra as m,s as E,v as J,va as d,wa as G,wb as st,ya as q,z as R,za as H}from"./chunk-D7UFLJ5T.mjs";import{a as T,b as W}from"./chunk-5XUXGTUW.mjs";var j={DEFAULT_PER_PAGE:15,MAX_PER_PAGE:100,MAX_FAVORITOS_POR_USUARIO:500,DIAS_RECIENTES_DEFAULT:7,DIAS_LIMPIEZA_DEFAULT:90,MIN_PRECIO_FILTRO:0,MAX_PRECIO_FILTRO:999999};var F=class o{static formatearTiempoAgregado(e){let t=new Date(e),r=new Date().getTime()-t.getTime(),c=Math.floor(r/(1e3*60)),b=Math.floor(r/(1e3*60*60)),x=Math.floor(r/(1e3*60*60*24)),B=Math.floor(x/7),z=Math.floor(x/30);return c<60?`hace ${c} minutos`:b<24?`hace ${b} horas`:x<7?`hace ${x} d\xEDas`:B<4?`hace ${B} semanas`:`hace ${z} meses`}static calcularAhorro(e,t){return!t||t>=e?0:e-t}static calcularPorcentajeDescuento(e,t){return!t||t>=e?0:Math.round((e-t)/e*100)}static estaDisponible(e){return e.activo&&e.stock>0}static getPrecioEfectivo(e){return e.precio_oferta&&e.precio_oferta<e.precio?e.precio_oferta:e.precio}static formatearPrecio(e,t="S/"){return`${t} ${e.toLocaleString("es-PE",{minimumFractionDigits:2})}`}static getEstadoProducto(e){return e.activo?e.stock<=0?{estado:"agotado",mensaje:"Sin stock",color:"text-red-500"}:{estado:"disponible",mensaje:"Disponible",color:"text-green-500"}:{estado:"inactivo",mensaje:"Producto no disponible",color:"text-gray-500"}}static generarResumenPorCategoria(e){let t={};return e.forEach(i=>{if(i.producto?.categoria){let r=i.producto.categoria.nombre;t[r]=(t[r]||0)+1}}),t}static filtrarFavoritos(e,t){return e.filter(i=>{let r=i.producto;if(!r||t.disponibles&&!o.estaDisponible(r)||t.conOfertas&&!r.tiene_oferta||t.categoria&&r.categoria?.nombre!==t.categoria)return!1;let c=o.getPrecioEfectivo(r);return!(t.precioMin&&c<t.precioMin||t.precioMax&&c>t.precioMax)})}static calcularValorTotal(e){return e.reduce((t,i)=>i.producto?t+o.getPrecioEfectivo(i.producto):t,0)}};var N=class o{http=R(lt);apiUrl=`${U.apiUrl}/vista/favoritos`;_favoritos=y([]);_loading=y(!1);_error=y(null);_totalItems=y(0);_resumen=y(null);favoritos=this._favoritos.asReadonly();loading=this._loading.asReadonly();error=this._error.asReadonly();totalItems=this._totalItems.asReadonly();resumen=this._resumen.asReadonly();isEmpty=_(()=>this._favoritos().length===0);hasError=_(()=>this._error()!==null);favoritosRecientes=_(()=>this._favoritos().filter(e=>{let t=new Date(e.created_at);return Math.floor((new Date().getTime()-t.getTime())/(1e3*60*60*24))<=j.DIAS_RECIENTES_DEFAULT}));favoritosConOfertas=_(()=>this._favoritos().filter(e=>e.producto?.tiene_oferta));favoritosDisponibles=_(()=>this._favoritos().filter(e=>F.estaDisponible(e.producto)));_currentFilters=new Y({});currentFilters$=this._currentFilters.asObservable();filtrosRapidos={todos:{},recientes:{recientes:j.DIAS_RECIENTES_DEFAULT,sort_by:"created_at",sort_direction:"desc"},con_ofertas:{con_ofertas:!0},disponibles:{productos_disponibles:!0},por_precio_alto:{sort_by:"producto_precio",sort_direction:"desc"},por_precio_bajo:{sort_by:"producto_precio",sort_direction:"asc"},esta_semana:{recientes:7,sort_by:"created_at",sort_direction:"desc"},este_mes:{recientes:30,sort_by:"created_at",sort_direction:"desc"}};getFavoritos(e={}){this._loading.set(!0),this._error.set(null);let t=new V;return Object.entries(e).forEach(([i,r])=>{r!=null&&r!==""&&(t=t.set(i,r.toString()))}),this.http.get(this.apiUrl,{params:t}).pipe(E(i=>{i.success&&(this._favoritos.set(i.data),this._totalItems.set(i.meta.total),this._currentFilters.next(e),this.updateResumen(i.data))}),v(i=>this.handleError(i)),g(()=>this._loading.set(!1)))}getFavorito(e){return this._loading.set(!0),this._error.set(null),this.http.get(`${this.apiUrl}/${e}`).pipe(v(t=>this.handleError(t)),g(()=>this._loading.set(!1)))}createFavorito(e){return this._loading.set(!0),this._error.set(null),this.http.post(this.apiUrl,e).pipe(E(t=>{if(t.success&&t.data){let i=this._favoritos();this._favoritos.set([t.data,...i]),this._totalItems.update(r=>r+1),this.updateResumen([t.data,...i])}}),v(t=>this.handleError(t)),g(()=>this._loading.set(!1)))}updateFavorito(e,t){return this._loading.set(!0),this._error.set(null),this.http.put(`${this.apiUrl}/${e}`,t).pipe(E(i=>{if(i.success&&i.data){let c=this._favoritos().map(b=>b.id===e?i.data:b);this._favoritos.set(c),this.updateResumen(c)}}),v(i=>this.handleError(i)),g(()=>this._loading.set(!1)))}deleteFavorito(e){return this._loading.set(!0),this._error.set(null),this.http.delete(`${this.apiUrl}/${e}`).pipe(E(t=>{if(t.success){let r=this._favoritos().filter(c=>c.id!==e);this._favoritos.set(r),this._totalItems.update(c=>c-1),this.updateResumen(r)}}),v(t=>this.handleError(t)),g(()=>this._loading.set(!1)))}getFavoritosByUsuario(e,t={}){this._loading.set(!0),this._error.set(null);let i=new V;return Object.entries(t).forEach(([r,c])=>{c!=null&&c!==""&&(i=i.set(r,c.toString()))}),this.http.get(`${this.apiUrl}/usuario/${e}`,{params:i}).pipe(v(r=>this.handleError(r)),g(()=>this._loading.set(!1)))}toggleFavorito(e,t){this._loading.set(!0),this._error.set(null);let i={user_id:e,producto_id:t};return this.http.post(`${this.apiUrl}/toggle`,i).pipe(E(r=>{if(r.success){let c=this._favoritos();if(r.accion==="agregado"&&r.data)this._favoritos.set([r.data,...c]),this._totalItems.update(b=>b+1),this.updateResumen([r.data,...c]);else if(r.accion==="eliminado"){let b=c.filter(x=>!(x.user_id===e&&x.producto_id===t));this._favoritos.set(b),this._totalItems.update(x=>x-1),this.updateResumen(b)}}}),v(r=>this.handleError(r)),g(()=>this._loading.set(!1)))}verificarFavorito(e){return this._loading.set(!0),this._error.set(null),this.http.post(`${this.apiUrl}/verificar`,e).pipe(v(t=>this.handleError(t)),g(()=>this._loading.set(!1)))}limpiarFavoritos(e){return this._loading.set(!0),this._error.set(null),this.http.delete(`${this.apiUrl}/limpiar`,{body:e}).pipe(E(t=>{t.success&&this.refresh()}),v(t=>this.handleError(t)),g(()=>this._loading.set(!1)))}getEstadisticas(e,t,i){this._loading.set(!0),this._error.set(null);let r=new V;return e&&(r=r.set("fecha_desde",e)),t&&(r=r.set("fecha_hasta",t)),i&&(r=r.set("user_id",i.toString())),this.http.get(`${this.apiUrl}/statistics`,{params:r}).pipe(v(c=>this.handleError(c)),g(()=>this._loading.set(!1)))}validateFavorito(e){let t=[],i={user_id:!1,producto_id:!1,isValid:!1,errors:t};return!e.user_id||e.user_id<=0?t.push("Debe especificar un usuario v\xE1lido"):i.user_id=!0,!e.producto_id||e.producto_id<=0?t.push("Debe especificar un producto v\xE1lido"):i.producto_id=!0,i.isValid=i.user_id&&i.producto_id,i}searchFavoritos(e,t={}){let i=W(T({},t),{search:e,per_page:t.per_page||j.DEFAULT_PER_PAGE});return this.getFavoritos(i)}aplicarFiltroRapido(e){let t=this.filtrosRapidos[e];return this.getFavoritos(t)}getFavoritosByCategoria(e){return this.getFavoritos({categoria_id:e})}getFavoritosConOfertas(){return this.getFavoritos({con_ofertas:!0})}getFavoritosDisponibles(){return this.getFavoritos({productos_disponibles:!0})}getFavoritosRecientes(e=j.DIAS_RECIENTES_DEFAULT){return this.getFavoritos({recientes:e,sort_by:"created_at",sort_direction:"desc"})}getFavoritosByRangoPrecio(e,t){return this.getFavoritos({rango_precio:`${e}-${t}`})}accionMasiva(e){return this._loading.set(!0),this._error.set(null),this.http.post(`${this.apiUrl}/accion-masiva`,e).pipe(E(t=>{t.success&&this.refresh()}),v(t=>this.handleError(t)),g(()=>this._loading.set(!1)))}exportarFavoritos(e,t={}){this._loading.set(!0),this._error.set(null);let i=new V;return Object.entries(t).forEach(([r,c])=>{c!=null&&c!==""&&(i=i.set(r,c.toString()))}),i=i.set("formato",e),this.http.get(`${this.apiUrl}/exportar`,{params:i,responseType:"blob"}).pipe(v(r=>this.handleError(r)),g(()=>this._loading.set(!1)))}refresh(){let e=this._currentFilters.value;this.getFavoritos(e).subscribe()}clearState(){this._favoritos.set([]),this._loading.set(!1),this._error.set(null),this._totalItems.set(0),this._resumen.set(null),this._currentFilters.next({})}getFavoritoFromState(e){return this._favoritos().find(t=>t.id===e)}existsInState(e){return this._favoritos().some(t=>t.id===e)}isProductoFavoritoInState(e,t){return this._favoritos().some(i=>i.user_id===e&&i.producto_id===t)}getFilteredFavoritosFromState(e){return this._favoritos().filter(e)}getFavoritosByUsuarioFromState(e){return this._favoritos().filter(t=>t.user_id===e)}getValorTotalFromState(){return F.calcularValorTotal(this._favoritos())}getDistribucionCategoriasFromState(){return F.generarResumenPorCategoria(this._favoritos())}filtrarFavoritosFromState(e){return F.filtrarFavoritos(this._favoritos(),e)}updateResumen(e){let t=e.length,i=new Date,r=e.filter(h=>{let O=new Date(h.created_at);return i.getTime()-O.getTime()<=24*60*60*1e3}).length,c=e.filter(h=>{let O=new Date(h.created_at);return i.getTime()-O.getTime()<=7*24*60*60*1e3}).length,b=e.filter(h=>{let O=new Date(h.created_at);return i.getTime()-O.getTime()<=30*24*60*60*1e3}).length,x=e.filter(h=>h.producto?F.estaDisponible(h.producto):!1).length,B=e.filter(h=>h.producto?.tiene_oferta).length,z=F.calcularValorTotal(e);this._resumen.set({total:t,recientes_24h:r,esta_semana:c,este_mes:b,productos_disponibles:x,productos_con_ofertas:B,valor_total:z})}handleError(e){let t="Ha ocurrido un error inesperado";return e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:e.status===0?t="No se puede conectar al servidor. Verifique su conexi\xF3n a internet.":e.status>=400&&e.status<500?t=e.error?.message||`Error del cliente: ${e.status}`:e.status>=500&&(t="Error interno del servidor. Intente nuevamente m\xE1s tarde."),this._error.set(t),console.error("Error en FavoritoService:",e),Z(()=>new Error(t))}utils=F;static \u0275fac=function(t){return new(t||o)};static \u0275prov=J({token:o,factory:o.\u0275fac,providedIn:"root"})};var ft=(o,e,t,i)=>({flex:o,"flex-col":e,"w-full":t,"max-w-sm":i}),vt=(o,e)=>({"aspect-square":o,"w-48 h-48 flex-shrink-0":e});function gt(o,e){if(o&1&&(s(0,"span",11),S(),s(1,"svg",12),w(2,"path",13),n(),u(3),n()),o&2){let t=l();m("text-2xs",t.vista()==="compacta")("px-1",t.vista()==="compacta")("py-0",t.vista()==="compacta"),a(),m("w-2",t.vista()==="compacta")("h-2",t.vista()==="compacta"),a(2),f(" ",t.configFinal().textoDestacado," ")}}function bt(o,e){if(o&1&&(s(0,"span",14),u(1),n()),o&2){let t=l();m("text-2xs",t.vista()==="compacta")("px-1",t.vista()==="compacta")("py-0",t.vista()==="compacta"),a(),f(" -",t.porcentajeDescuento(),"% ")}}function xt(o,e){if(o&1&&(s(0,"span",15),u(1," \xA1\xDAltimos! "),n()),o&2){let t=l();m("text-2xs",t.vista()==="compacta")("px-1",t.vista()==="compacta")("py-0",t.vista()==="compacta")}}function ht(o,e){if(o&1&&(s(0,"span",16),u(1," Sin Stock "),n()),o&2){let t=l();m("text-2xs",t.vista()==="compacta")("px-1",t.vista()==="compacta")("py-0",t.vista()==="compacta")}}function Ct(o,e){o&1&&(S(),s(0,"svg",20),w(1,"circle",22)(2,"path",23),n())}function Ft(o,e){if(o&1&&(S(),s(0,"svg",24),w(1,"path",25),n()),o&2){let t=l(3);m("text-red-500",t.esFavorito())("text-gray-600",!t.esFavorito()),et("fill",t.esFavorito()?"currentColor":"none")}}function yt(o,e){if(o&1){let t=A();s(0,"button",19),k("click",function(r){M(t);let c=l(2);return D(c.toggleFavorito(r))}),p(1,Ct,3,0,":svg:svg",20)(2,Ft,2,5,":svg:svg",21),n()}if(o&2){let t=l(2);m("opacity-50",t.cargandoFavorito()),P("disabled",t.cargandoFavorito())("title",t.esFavorito()?"Quitar de favoritos":"Agregar a favoritos"),a(),d(t.cargandoFavorito()?1:2)}}function Pt(o,e){if(o&1){let t=A();s(0,"button",26),k("click",function(r){M(t);let c=l(2);return D(c.mostrarVistaRapida(r))}),S(),s(1,"svg",27),w(2,"path",28)(3,"path",29),n()()}}function Et(o,e){if(o&1&&(s(0,"div",8),p(1,yt,3,5,"button",17)(2,Pt,4,0,"button",18),n()),o&2){let t=l();a(),d(t.configFinal().mostrarFavoritos?1:-1),a(),d(t.configFinal().mostrarVistaRapida?2:-1)}}function Rt(o,e){if(o&1&&(s(0,"span"),u(1),n()),o&2){let t=l(3);a(),C(t.producto().marca)}}function St(o,e){o&1&&(s(0,"span",43),u(1,"|"),n())}function wt(o,e){if(o&1&&(s(0,"span"),u(1),n()),o&2){let t,i=l(3);a(),C((t=i.producto().categoria)==null?null:t.nombre)}}function kt(o,e){if(o&1&&(s(0,"div",34),p(1,Rt,2,1,"span")(2,St,2,0,"span",43)(3,wt,2,1,"span"),n()),o&2){let t,i,r=l(2);a(),d(r.configFinal().mostrarMarca&&r.producto().marca?1:-1),a(),d(r.configFinal().mostrarMarca&&r.configFinal().mostrarCategoria&&r.producto().marca&&((t=r.producto().categoria)!=null&&t.nombre)?2:-1),a(),d(r.configFinal().mostrarCategoria&&((i=r.producto().categoria)!=null&&i.nombre)?3:-1)}}function Ot(o,e){if(o&1&&(s(0,"span",11),u(1),n()),o&2){let t=l(2);a(),f(" \u2B50 ",t.configFinal().textoDestacado," ")}}function Tt(o,e){if(o&1&&(s(0,"span",14),u(1),n()),o&2){let t=l(2);a(),f(" -",t.porcentajeDescuento(),"% ")}}function Mt(o,e){if(o&1&&(s(0,"p",36),u(1),n()),o&2){let t=l(2);a(),f(" ",t.producto().descripcion," ")}}function Dt(o,e){if(o&1&&(S(),s(0,"svg",47),w(1,"path",13),n()),o&2){let t=e.$implicit;m("text-yellow-400",t.llena)("text-gray-300",!t.llena)}}function It(o,e){if(o&1&&(s(0,"div",37)(1,"div",44),q(2,Dt,2,4,":svg:svg",45,G),n(),s(4,"span",46),u(5),n()()),o&2){let t=l(2);a(2),H(t.estrellas()),a(3),f("(",t.producto().total_comentarios," rese\xF1as)")}}function At(o,e){if(o&1&&(s(0,"div",39)(1,"span",48),u(2),n(),s(3,"span",49),u(4),n()()),o&2){let t=l(2);a(2),C(t.precioOfertaFormateado()),a(2),C(t.precioFormateado())}}function Vt(o,e){if(o&1&&(s(0,"span",40),u(1),n()),o&2){let t=l(2);a(),C(t.precioFormateado())}}function Ut(o,e){if(o&1&&(s(0,"p",41),u(1),n()),o&2){let t=l(2);a(),f(" Stock: ",t.producto().stock," unidades ")}}function jt(o,e){o&1&&u(0," Sin Stock ")}function Bt(o,e){o&1&&u(0," Ver producto ")}function $t(o,e){if(o&1){let t=A();s(0,"button",50),k("click",function(r){M(t);let c=l(2);return D(c.verProducto(r))}),p(1,jt,1,0)(2,Bt,1,0),n()}if(o&2){let t=l(2);P("disabled",t.producto().stock===0),a(),d(t.producto().stock===0?1:2)}}function Lt(o,e){if(o&1&&(s(0,"div",10)(1,"div",30)(2,"div",31)(3,"div",30)(4,"h3",32)(5,"a",33),u(6),n()(),p(7,kt,4,3,"div",34),n(),s(8,"div",35),p(9,Ot,2,1,"span",11)(10,Tt,2,1,"span",14),n()(),p(11,Mt,2,1,"p",36)(12,It,6,1,"div",37),s(13,"div",38)(14,"div"),p(15,At,5,2,"div",39)(16,Vt,2,1,"span",40)(17,Ut,2,1,"p",41),n(),p(18,$t,3,2,"button",42),n()()()),o&2){let t=l();a(5),P("href",t.linkProducto(),L),a(),C(t.producto().nombre),a(),d(t.configFinal().mostrarMarca||t.configFinal().mostrarCategoria?7:-1),a(2),d(t.producto().destacado?9:-1),a(),d(t.porcentajeDescuento()>0?10:-1),a(),d(t.configFinal().mostrarDescripcion&&t.producto().descripcion?11:-1),a(),d(t.configFinal().mostrarRating&&t.producto().rating_promedio?12:-1),a(3),d(t.precioOferta()?15:16),a(2),d(t.configFinal().mostrarStock?17:-1),a(),d(t.configFinal().mostrarBotonCarrito?18:-1)}}function Nt(o,e){if(o&1&&(s(0,"span"),u(1),n()),o&2){let t=l(3);a(),C(t.producto().marca)}}function zt(o,e){if(o&1&&(s(0,"span"),u(1),n()),o&2){let t,i=l(3);a(),C((t=i.producto().categoria)==null?null:t.nombre)}}function Gt(o,e){if(o&1&&(s(0,"div",51),p(1,Nt,2,1,"span")(2,zt,2,1,"span"),n()),o&2){let t,i=l(2);a(),d(i.configFinal().mostrarMarca&&i.producto().marca?1:-1),a(),d(i.configFinal().mostrarCategoria&&((t=i.producto().categoria)!=null&&t.nombre)?2:-1)}}function qt(o,e){if(o&1&&(s(0,"p",53),u(1),n()),o&2){let t=l(2);a(),f(" ",t.producto().descripcion," ")}}function Ht(o,e){if(o&1&&(S(),s(0,"svg",47),w(1,"path",13),n()),o&2){let t=e.$implicit,i=l(3);m("w-3",i.vista()==="compacta")("h-3",i.vista()==="compacta")("text-yellow-400",t.llena)("text-gray-300",!t.llena)}}function Xt(o,e){if(o&1&&(s(0,"span",46),u(1),n()),o&2){let t=l(3);a(),f("(",t.producto().total_comentarios,")")}}function Qt(o,e){if(o&1&&(s(0,"div",54)(1,"div",44),q(2,Ht,2,8,":svg:svg",59,G),n(),p(4,Xt,2,1,"span",46),n()),o&2){let t=l(2);a(2),H(t.estrellas()),a(2),d(t.vista()!=="compacta"?4:-1)}}function Wt(o,e){if(o&1&&(s(0,"span",60),u(1),n(),s(2,"span",61),u(3),n()),o&2){let t=l(2);m("text-lg",t.vista()==="grid")("text-base",t.vista()==="compacta"),a(),f(" ",t.precioOfertaFormateado()," "),a(),m("text-sm",t.vista()==="grid")("text-xs",t.vista()==="compacta"),a(),f(" ",t.precioFormateado()," ")}}function Yt(o,e){if(o&1&&(s(0,"span",62),u(1),n()),o&2){let t=l(2);m("text-lg",t.vista()==="grid")("text-base",t.vista()==="compacta"),a(),f(" ",t.precioFormateado()," ")}}function Zt(o,e){if(o&1&&(s(0,"div",57),u(1),n()),o&2){let t=l(2);a(),f("Stock: ",t.producto().stock,"")}}function Jt(o,e){o&1&&u(0," Sin Stock ")}function Kt(o,e){o&1&&u(0," Ver producto ")}function te(o,e){if(o&1){let t=A();s(0,"button",63),k("click",function(r){M(t);let c=l(2);return D(c.verProducto(r))}),p(1,Jt,1,0)(2,Kt,1,0),n()}if(o&2){let t=l(2);m("text-sm",t.vista()==="compacta")("py-1",t.vista()==="compacta"),P("disabled",t.producto().stock===0),a(),d(t.producto().stock===0?1:2)}}function ee(o,e){if(o&1&&(p(0,Gt,3,2,"div",51),s(1,"h3",52)(2,"a",33),u(3),n()(),p(4,qt,2,1,"p",53)(5,Qt,5,1,"div",54),s(6,"div",55)(7,"div",39),p(8,Wt,4,10)(9,Yt,2,5,"span",56),n(),p(10,Zt,2,1,"div",57),n(),p(11,te,3,6,"button",58)),o&2){let t=l();d((t.configFinal().mostrarMarca||t.configFinal().mostrarCategoria)&&t.vista()!=="compacta"?0:-1),a(),m("text-lg",t.vista()==="grid")("text-base",t.vista()==="compacta")("line-clamp-2",t.vista()==="grid")("line-clamp-1",t.vista()==="compacta"),a(),P("href",t.linkProducto(),L),a(),C(t.producto().nombre),a(),d(t.configFinal().mostrarDescripcion&&t.producto().descripcion&&t.vista()==="grid"?4:-1),a(),d(t.configFinal().mostrarRating&&t.producto().rating_promedio?5:-1),a(),m("mb-3",t.vista()==="compacta")("flex-col",t.vista()==="compacta")("items-start",t.vista()==="compacta")("space-y-1",t.vista()==="compacta"),a(2),d(t.precioOferta()?8:9),a(2),d(t.configFinal().mostrarStock&&t.vista()!=="compacta"?10:-1),a(),d(t.configFinal().mostrarBotonCarrito?11:-1)}}var oe={mostrarMarca:!0,mostrarCategoria:!0,mostrarDescripcion:!0,mostrarRating:!0,mostrarStock:!0,mostrarBotonCarrito:!0,mostrarAccionesRapidas:!0,mostrarFavoritos:!0,mostrarVistaRapida:!0,stockBajo:5,urlPorDefecto:"productos/default.jpg",textoDestacado:"Destacado"},mt=class o{platformId=R(tt);router=R(dt);authService=R(pt);favoritoService=R(N);producto=$.required();vista=$("grid");configuracion=$({});onCarritoClick=I();onFavoritoToggle=I();onVistaRapida=I();onProductoClick=I();esFavorito=y(!1);cargandoFavorito=y(!1);verificarFavoritoEffect=nt(()=>{let e=this.authService.currentUser(),t=this.producto();at(()=>{e&&t&&X(this.platformId)?this.verificarFavorito(e.id,t.id):this.esFavorito.set(!1)})});configFinal=_(()=>T(T({},oe),this.configuracion()));imagenUrl=_(()=>{let e=this.producto(),t=U.baseUrlImagenes||"";return e.imagen_principal?e.imagen_principal.startsWith("http")?e.imagen_principal:t+e.imagen_principal:t+this.configFinal().urlPorDefecto});linkProducto=_(()=>{let e=this.producto();return`/producto/${e.slug||e.id}`});precioFormateado=_(()=>{let e=this.producto();return this.formatearPrecio(e.precio)});precioOferta=_(()=>this.producto().precio_oferta||null);precioOfertaFormateado=_(()=>{let e=this.precioOferta();return e?this.formatearPrecio(e):null});porcentajeDescuento=_(()=>{let e=this.producto(),t=this.precioOferta();return!t||t>=e.precio?0:Math.round((e.precio-t)/e.precio*100)});estrellas=_(()=>{let t=this.producto().rating_promedio||0,i=[];for(let r=1;r<=5;r++)i.push({llena:r<=Math.round(t)});return i});formatearPrecio(e){let t=this.producto().moneda||"COP";return X(this.platformId)?new Intl.NumberFormat("es-CO",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e):`$${e.toLocaleString("es-CO")}`}onImageError(e){let t=e.target,i=U.baseUrlImagenes||"",r=this.configFinal().urlPorDefecto;t.src=i+r}agregarAlCarrito(e){e.preventDefault(),e.stopPropagation(),this.onCarritoClick.emit({producto:this.producto(),event:e})}toggleFavorito(e){if(e.preventDefault(),e.stopPropagation(),!this.authService.isAuthenticated()){this.router.navigate(["/auth/login"],{queryParams:{returnUrl:this.router.url}});return}let t=this.authService.currentUser(),i=this.producto();if(!t||!i){console.error("Usuario o producto no disponible");return}this.cargandoFavorito()||(this.cargandoFavorito.set(!0),this.favoritoService.toggleFavorito(t.id,i.id).subscribe({next:r=>{r.success&&(this.esFavorito.set(r.accion==="agregado"),this.onFavoritoToggle.emit({producto:this.producto(),event:e}))},error:r=>{console.error("Error al cambiar favorito:",r)},complete:()=>{this.cargandoFavorito.set(!1)}}))}verificarFavorito(e,t){this.favoritoService.verificarFavorito({user_id:e,producto_id:t}).subscribe({next:i=>{i.success&&this.esFavorito.set(i.es_favorito)},error:i=>{console.error("Error al verificar favorito:",i),this.esFavorito.set(!1)}})}mostrarVistaRapida(e){e.preventDefault(),e.stopPropagation(),this.onVistaRapida.emit({producto:this.producto(),event:e})}onProductoClickHandler(e){this.onProductoClick.emit({producto:this.producto(),event:e})}verProducto(e){e.preventDefault(),e.stopPropagation();let t=this.producto();this.router.navigate(["/producto",t.slug||t.id])}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=K({type:o,selectors:[["app-producto-card"]],inputs:{producto:[1,"producto"],vista:[1,"vista"],configuracion:[1,"configuracion"]},outputs:{onCarritoClick:"onCarritoClick",onFavoritoToggle:"onFavoritoToggle",onVistaRapida:"onVistaRapida",onProductoClick:"onProductoClick"},standalone:!0,features:[ot],decls:12,vars:32,consts:[[1,"bg-white","border","border-gray-300","shadow-sm","hover:shadow-md","transition-all","duration-200","overflow-hidden","group",3,"ngClass"],[1,"bg-gray-100","overflow-hidden","relative",3,"ngClass"],["loading","lazy",1,"w-full","h-full","object-cover","transition-transform","duration-300",3,"error","src","alt"],[1,"absolute","top-2","left-2","flex","flex-col","space-y-1"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-yellow-100","text-yellow-800",3,"text-2xs","px-1","py-0"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-red-100","text-red-800",3,"text-2xs","px-1","py-0"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-orange-100","text-orange-800",3,"text-2xs","px-1","py-0"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-800",3,"text-2xs","px-1","py-0"],[1,"absolute","top-2","right-2","flex","flex-col","space-y-1","opacity-0","group-hover:opacity-100","transition-opacity","duration-200"],[1,"p-4","flex-1"],[1,"flex","justify-between","h-full"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-yellow-100","text-yellow-800"],["fill","currentColor","viewBox","0 0 20 20",1,"w-3","h-3","mr-1"],["d","M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-red-100","text-red-800"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-orange-100","text-orange-800"],[1,"inline-flex","items-center","px-2","py-1","rounded-full","text-xs","font-medium","bg-gray-100","text-gray-800"],["type","button",1,"p-2","bg-white","rounded-full","shadow-md","hover:bg-gray-50","transition-colors","duration-200","relative",3,"opacity-50","disabled","title"],["type","button","title","Vista R\xE1pida",1,"p-2","bg-white","rounded-full","shadow-md","hover:bg-gray-50","transition-colors","duration-200"],["type","button",1,"p-2","bg-white","rounded-full","shadow-md","hover:bg-gray-50","transition-colors","duration-200","relative",3,"click","disabled","title"],["fill","none","viewBox","0 0 24 24",1,"w-4","h-4","animate-spin","text-gray-600"],["stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","transition-colors","duration-200",3,"text-red-500","text-gray-600"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",1,"opacity-75"],["stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","transition-colors","duration-200"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"],["type","button","title","Vista R\xE1pida",1,"p-2","bg-white","rounded-full","shadow-md","hover:bg-gray-50","transition-colors","duration-200",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12a3 3 0 11-6 0 3 3 0 016 0z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"],[1,"flex-1"],[1,"flex","items-start","justify-between","mb-2"],[1,"text-xl","font-semibold","text-gray-900","hover:text-blue-600","transition-colors","duration-200","line-clamp-1"],[1,"block",3,"href"],[1,"flex","items-center","text-sm","text-gray-600","mt-1"],[1,"flex","flex-col","space-y-1","ml-4"],[1,"text-gray-700","mb-3","line-clamp-2"],[1,"flex","items-center","mb-3"],[1,"flex","items-end","justify-between"],[1,"flex","items-center","space-x-2"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500","mt-1"],["type","button",1,"bg-blue-500","text-white","px-6","py-2","font-medium","hover:bg-blue-600","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:ring-offset-2","transition-colors","duration-200","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"disabled"],[1,"mx-1"],[1,"flex","items-center"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4",3,"text-yellow-400","text-gray-300"],[1,"ml-2","text-sm","text-gray-600"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4"],[1,"text-2xl","font-bold","text-green-600"],[1,"text-lg","text-gray-500","line-through"],["type","button",1,"bg-blue-500","text-white","px-6","py-2","font-medium","hover:bg-blue-600","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:ring-offset-2","transition-colors","duration-200","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"click","disabled"],[1,"flex","items-center","justify-between","text-xs","text-gray-500","mb-2"],[1,"font-semibold","text-gray-900","mb-2","group-hover:text-blue-600","transition-colors","duration-200"],[1,"text-gray-600","text-sm","mb-2","line-clamp-2"],[1,"flex","items-center","mb-2"],[1,"flex","items-center","justify-between","mb-4"],[1,"font-bold","text-gray-900",3,"text-lg","text-base"],[1,"text-sm","text-gray-500"],["type","button",1,"w-full","bg-blue-500","text-white","px-4","py-2","font-medium","hover:bg-blue-600","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:ring-offset-2","transition-colors","duration-200","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"text-sm","py-1","disabled"],["fill","currentColor","viewBox","0 0 20 20",1,"w-4","h-4",3,"w-3","h-3","text-yellow-400","text-gray-300"],[1,"font-bold","text-green-600"],[1,"text-gray-500","line-through"],[1,"font-bold","text-gray-900"],["type","button",1,"w-full","bg-blue-500","text-white","px-4","py-2","font-medium","hover:bg-blue-600","focus:outline-none","focus:ring-2","focus:ring-blue-400","focus:ring-offset-2","transition-colors","duration-200","disabled:bg-gray-300","disabled:cursor-not-allowed",3,"click","disabled"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"div",1)(2,"img",2),k("error",function(c){return i.onImageError(c)}),n(),s(3,"div",3),p(4,gt,4,11,"span",4)(5,bt,2,7,"span",5)(6,xt,2,6,"span",6)(7,ht,2,6,"span",7),n(),p(8,Et,3,2,"div",8),n(),s(9,"div",9),p(10,Lt,19,10,"div",10)(11,ee,12,24),n()()),t&2&&(P("ngClass",rt(24,ft,i.vista()==="lista",i.vista()!=="lista",i.vista()==="lista",i.vista()==="compacta")),a(),P("ngClass",it(29,vt,i.vista()==="grid"||i.vista()==="compacta",i.vista()==="lista")),a(),m("group-hover:scale-105",i.vista()!=="lista"),P("src",i.imagenUrl(),L)("alt",i.producto().nombre),a(),m("top-1",i.vista()==="compacta")("left-1",i.vista()==="compacta"),a(),d(i.producto().destacado?4:-1),a(),d(i.porcentajeDescuento()>0?5:-1),a(),d(i.producto().stock<=i.configFinal().stockBajo&&i.producto().stock>0?6:-1),a(),d(i.producto().stock===0?7:-1),a(),d(i.configFinal().mostrarAccionesRapidas&&i.vista()!=="compacta"?8:-1),a(),m("p-3",i.vista()==="compacta")("flex",i.vista()==="lista")("flex-col",i.vista()==="lista")("justify-between",i.vista()==="lista"),a(),d(i.vista()==="lista"?10:11))},dependencies:[ct,st,ut],styles:['.group[_ngcontent-%COMP%]:hover   .group-hover\\:scale-105[_ngcontent-%COMP%]{transform:scale(1.05)}.line-clamp-1[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:1;-webkit-box-orient:vertical;overflow:hidden}.line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.line-clamp-3[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}.text-2xs[_ngcontent-%COMP%]{font-size:.625rem;line-height:.75rem}.producto-card-btn[_ngcontent-%COMP%]{transition:all .2s ease-in-out}.producto-card-btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px);box-shadow:0 4px 8px #0000001f}.badge-animate[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInScale .3s ease-out}@keyframes _ngcontent-%COMP%_fadeInScale{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}.image-loading[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f0f0f0 25%,#e0e0e0,#f0f0f0 75%);background-size:200% 100%;animation:_ngcontent-%COMP%_loading 1.5s infinite}@keyframes _ngcontent-%COMP%_loading{0%{background-position:200% 0}to{background-position:-200% 0}}.focus-ring[_ngcontent-%COMP%]:focus{outline:2px solid #3b82f6;outline-offset:2px}@media (max-width: 640px){.producto-card-mobile[_ngcontent-%COMP%]{margin:.5rem}.producto-card-mobile[_ngcontent-%COMP%]   .text-lg[_ngcontent-%COMP%]{font-size:1rem;line-height:1.5rem}}.producto-sin-stock[_ngcontent-%COMP%]{opacity:.7;position:relative}.producto-sin-stock[_ngcontent-%COMP%]:after{content:"";position:absolute;inset:0;background:#0000001a;pointer-events:none}.favorito-activo[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_heartBeat .6s ease-in-out}@keyframes _ngcontent-%COMP%_heartBeat{0%{transform:scale(1)}25%{transform:scale(1.15)}40%{transform:scale(1)}60%{transform:scale(1.05)}to{transform:scale(1)}}.shadow-product-card[_ngcontent-%COMP%]{box-shadow:0 1px 3px #0000001a,0 1px 2px #0000000f}.shadow-product-card-hover[_ngcontent-%COMP%]{box-shadow:0 4px 15px #0000001a,0 2px 4px #0000000f}.precio-oferta[_ngcontent-%COMP%]{background:linear-gradient(135deg,#10b981,#059669);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}.aspect-product[_ngcontent-%COMP%]{aspect-ratio:4 / 3}.aspect-product-square[_ngcontent-%COMP%]{aspect-ratio:1 / 1}']})};export{mt as a};
