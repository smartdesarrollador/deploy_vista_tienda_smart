import{a as j}from"./chunk-ZLRWYHEX.js";import"./chunk-IYW2DV6Z.js";import{$a as I,A as T,Aa as c,Ab as A,Ca as d,G as v,H as x,I as C,J as y,Ja as F,U as E,Z as r,ca as m,db as V,ea as p,ga as w,ia as _,ma as f,pa as M,qa as L,ra as n,sa as a,ta as g,ua as h,va as u,wa as l,z as S}from"./chunk-7RPVYQIG.js";import{a as k,b as N}from"./chunk-6MDQTQU3.js";var U=(o,t)=>t.id;function D(o,t){if(o&1){let e=h();n(0,"button",12),u("click",function(){v(e);let s=l();return x(s.marcarTodasLeidas())}),c(1," Marcar todas como le\xEDdas "),a()}}function P(o,t){o&1&&(n(0,"div",10),g(1,"div",13),n(2,"p",14),c(3,"Cargando notificaciones..."),a()())}function $(o,t){if(o&1&&(n(0,"div",10)(1,"div",15),C(),n(2,"svg",16),g(3,"path",17),a()(),y(),n(4,"h3",18),c(5," No hay notificaciones "),a(),n(6,"p",19),c(7),a()()),o&2){let e=l();r(7),d(" ",e.filtroActivo()==="no_leidas"?"No tienes notificaciones sin leer":"No tienes notificaciones a\xFAn"," ")}}function O(o,t){o&1&&g(0,"span",29)}function B(o,t){if(o&1){let e=h();n(0,"button",33),u("click",function(s){v(e);let b=l().$implicit,z=l(2);return x(z.ejecutarAccion(b,s))}),c(1),a()}if(o&2){let e=l().$implicit;r(),d(" ",e.accion_texto||"Ver m\xE1s"," ")}}function G(o,t){if(o&1){let e=h();n(0,"div",21),u("click",function(){let s=v(e).$implicit,b=l(2);return x(b.marcarComoLeida(s))}),n(1,"div",22)(2,"div",23),C(),g(3,"svg",24),a(),y(),n(4,"div",25)(5,"div",26)(6,"h3",27),c(7),a(),n(8,"div",28),p(9,O,1,0,"span",29),n(10,"span",30),c(11),a()()(),n(12,"p",31),c(13),a(),p(14,B,2,1,"button",32),a()()()}if(o&2){let e=t.$implicit,i=l(2);_("bg-blue-50",!e.leido),r(2),w("ngClass",i.getTipoIconoClass(e.tipo)),r(),w("innerHTML",i.getTipoIcono(e.tipo),E),r(4),d(" ",e.titulo," "),r(2),f(e.leido?-1:9),r(2),d(" ",i.formatearFecha(e.fecha)," "),r(2),d(" ",e.mensaje," "),r(),f(e.accion_url?14:-1)}}function R(o,t){if(o&1&&(n(0,"div",11),M(1,G,15,9,"div",20,U),a()),o&2){let e=l();r(),L(e.notificacionesFiltradas())}}var H=class o{cuentaUsuarioService=S(j);notificaciones=m([]);isLoading=m(!1);filtroActivo=m("todas");noLeidas=m(0);notificacionesFiltradas=m([]);ngOnInit(){this.cargarNotificaciones(),this.actualizarFiltros()}cargarNotificaciones(){this.isLoading.set(!0),this.cuentaUsuarioService.getNotificaciones().subscribe({next:t=>{t.status==="success"&&(this.notificaciones.set(t.data.notificaciones.map(e=>N(k({},e),{fecha:e.created_at}))),this.actualizarFiltros()),this.isLoading.set(!1)},error:t=>{console.error("Error cargando notificaciones:",t),this.isLoading.set(!1)}})}actualizarFiltros(){let t=this.notificaciones();this.noLeidas.set(t.filter(i=>!i.leido).length),this.filtroActivo()==="no_leidas"?this.notificacionesFiltradas.set(t.filter(i=>!i.leido)):this.notificacionesFiltradas.set(t)}marcarComoLeida(t){t.leido||this.cuentaUsuarioService.marcarNotificacionLeida(t.id).subscribe({next:e=>{e.success&&(t.leido=!0,this.actualizarFiltros())}})}marcarTodasLeidas(){this.cuentaUsuarioService.marcarTodasNotificacionesLeidas().subscribe({next:t=>{t.success&&this.cargarNotificaciones()}})}ejecutarAccion(t,e){e.stopPropagation(),t.accion_url&&console.log("Ejecutar acci\xF3n:",t.accion_url)}getTipoIconoClass(t){return{pedido:"bg-blue-100 text-blue-600",promocion:"bg-green-100 text-green-600",sistema:"bg-gray-100 text-gray-600",pago:"bg-yellow-100 text-yellow-600"}[t]||"bg-gray-100 text-gray-600"}getTipoIcono(t){let e={pedido:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>',promocion:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>',sistema:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>',pago:'<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>'};return e[t]||e.sistema}formatearFecha(t){let e=new Date,i=new Date(t),s=Math.floor((e.getTime()-i.getTime())/(1e3*60*60));return s<1?"Hace unos minutos":s<24?`Hace ${s}h`:s<48?"Ayer":i.toLocaleDateString("es-PE",{day:"2-digit",month:"short"})}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=T({type:o,selectors:[["app-notificaciones"]],standalone:!0,features:[F],decls:19,vars:16,consts:[[1,"space-y-6"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","p-6"],[1,"flex","justify-between","items-center"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-gray-600","mt-1"],[1,"px-4","py-2","bg-blue-600","text-white","text-sm","font-medium","rounded-lg","hover:bg-blue-700","transition-colors"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","p-4"],[1,"flex","space-x-4"],[1,"px-3","py-1.5","text-sm","font-medium","rounded-lg","transition-colors",3,"click"],[1,"bg-white","rounded-lg","shadow-sm","border","border-gray-200","overflow-hidden"],[1,"p-8","text-center"],[1,"divide-y","divide-gray-200"],[1,"px-4","py-2","bg-blue-600","text-white","text-sm","font-medium","rounded-lg","hover:bg-blue-700","transition-colors",3,"click"],[1,"animate-spin","rounded-full","h-8","w-8","border-b-2","border-blue-600","mx-auto"],[1,"text-gray-600","mt-4"],[1,"w-16","h-16","bg-gray-100","rounded-full","flex","items-center","justify-center","mx-auto","mb-4"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-8","h-8","text-gray-400"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 17h5l-5 5v-5zM4 19h6v2H4v-2zM4 15h8v2H4v-2zM4 11h10v2H4v-2zM4 7h12v2H4V7z"],[1,"text-lg","font-medium","text-gray-900","mb-2"],[1,"text-gray-600"],[1,"p-6","hover:bg-gray-50","transition-colors","cursor-pointer",3,"bg-blue-50"],[1,"p-6","hover:bg-gray-50","transition-colors","cursor-pointer",3,"click"],[1,"flex","items-start","space-x-4"],[1,"flex-shrink-0","w-10","h-10","rounded-full","flex","items-center","justify-center",3,"ngClass"],["fill","currentColor","viewBox","0 0 24 24",1,"w-5","h-5",3,"innerHTML"],[1,"flex-1","min-w-0"],[1,"flex","items-center","justify-between"],[1,"text-sm","font-medium","text-gray-900","truncate"],[1,"flex","items-center","space-x-2","ml-4"],[1,"w-2","h-2","bg-blue-600","rounded-full"],[1,"text-xs","text-gray-500","whitespace-nowrap"],[1,"text-sm","text-gray-600","mt-1"],[1,"text-blue-600","hover:text-blue-800","text-sm","font-medium","mt-2"],[1,"text-blue-600","hover:text-blue-800","text-sm","font-medium","mt-2",3,"click"]],template:function(e,i){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),c(5,"Notificaciones"),a(),n(6,"p",4),c(7," Mantente al d\xEDa con tus pedidos y ofertas "),a()(),p(8,D,2,0,"button",5),a()(),n(9,"div",6)(10,"div",7)(11,"button",8),u("click",function(){return i.filtroActivo.set("todas")}),c(12),a(),n(13,"button",8),u("click",function(){return i.filtroActivo.set("no_leidas")}),c(14),a()()(),n(15,"div",9),p(16,P,4,0,"div",10)(17,$,8,1,"div",10)(18,R,3,0,"div",11),a()()),e&2&&(r(8),f(i.noLeidas()>0?8:-1),r(3),_("bg-blue-600",i.filtroActivo()==="todas")("text-white",i.filtroActivo()==="todas")("bg-gray-100",i.filtroActivo()!=="todas"),r(),d(" Todas (",i.notificaciones().length,") "),r(),_("bg-blue-600",i.filtroActivo()==="no_leidas")("text-white",i.filtroActivo()==="no_leidas")("bg-gray-100",i.filtroActivo()!=="no_leidas"),r(),d(" No le\xEDdas (",i.noLeidas(),") "),r(2),f(i.isLoading()?16:i.notificacionesFiltradas().length===0?17:18))},dependencies:[V,I,A],styles:[".transition-colors[_ngcontent-%COMP%]{transition:color .2s,background-color .2s}"]})};export{H as NotificacionesComponent};
